# 開發計畫 (PLAN): 0.1 網站登入畫面
**版本**: 1.0  
**狀態**: [草稿]  
**負責人**: [IT 工程師 (您)]  
**依據規格**: `規格文件 (SPEC)-0.1.網站登入畫面.md` (v1.0)  
**依據憲章**: v2.1.0

## 1. 目標與範圍 (Objectives & Scope)
- 建立符合 `standards/2.文件倉儲管理系統 Warehouse Management System 設計規範v2.0.md` 與憲章要求的 Web 登入頁面。  
- 實作帳號/密碼驗證、錯誤提示、6 次錯誤鎖定、二階段驗證 (SMS/Email)、自動登出提示。  
- 套用系統 Logo `CROWN-Logo.png`，確保品牌一致性。  
- 交付前端 UI、登入流程 API 串接、稽核記錄串接與基本測試報告。

## 2. 里程碑 (Milestones)
| 里程碑 | 說明 | 產出物 | 預計完成 |
| --- | --- | --- | --- |
| M1 | UI/UX 設計確認 | Wireframe、Style Spec (含 Logo 放置) | W1 |
| M2 | 前端登入頁面實作 | React 頁面、狀態管理、深色模式切換 | W2 |
| M3 | 驗證流程串接 | 與 IdP 的 OIDC/OAuth2、2FA API 串接、錯誤計數 | W3 |
| M4 | 測試與稽核整合 | 單元/整合測試結果、稽核資料驗證 | W4 |
| M5 | 上線前檢查 | 安全檢核、憲章遵循檢查、交付報告 | W5 |

## 3. 工作分解 (Work Breakdown Structure)
1. **需求確認**
   - 與利害關係人確認登入流程、2FA 渠道、錯誤訊息文案。
   - 取得與驗證 `CROWN-Logo.png` 使用規範。
2. **UI/UX**
   - 依 Spec 建立登入頁面 Wireframe（桌面/平板/深色模式）。  
   - 定義顏色、字體、按鈕樣式，並撰寫 UI Prototype。  
3. **前端開發**
   - 建立 `LoginPage` 模組、表單驗證 (React Hook Form / Zod)。  
   - 實作密碼顯示切換、Loading 狀態、錯誤提示。  
   - 實作深色模式切換（偵測 OS 偏好 + 手動切換 + 儲存偏好）。  
4. **後端/串接**
   - 與中央 IdP 建立 OIDC Client，完成 PKCE/Token 流程。  
   - 實作登入錯誤次數計數、6 次鎖定邏輯、稽核寫入。  
   - 建立 2FA 驗證碼發送與驗證 API（SMS / Email）。  
5. **稽核與安全**
   - 確認所有登入/2FA/鎖定事件寫入 `系統操作紀錄` 模組。  
   - 驗證 HTTPS、CSRF 保護、敏感資訊遮蔽。  
6. **測試**
   - 單元測試：表單驗證、錯誤訊息、狀態切換。  
   - 整合測試：登入 -> 2FA -> Dashboard、錯誤六次鎖定、鎖定解除流程。  
   - 安全測試：暴力破解防護、Session Fixation、XSS/CSRF。  
7. **交付與回顧**
   - 撰寫使用手冊 (登入流程、常見問題)。  
   - 憲章遵循檢查、Risk Review、回顧會議。

## 4. 技術設計摘要 (Technical Design Summary)
- **前端**：React 18 + Next.js 14 (或專案既定框架)，Tailwind CSS。  
- **狀態管理**：使用專案既定工具 (如 Redux Toolkit)。  
- **驗證**：使用 Form 驗證庫 (Zod/Yup)，以正體中文錯誤訊息顯示。  
- **2FA**：OTP 長度 6、有效時間 5 分鐘、重送間隔 60 秒。  
- **Logo**：`CROWN-Logo.png` 於登入表單上方置中，提供高解析度資產。  
- **日誌**：登入/2FA/鎖定結果送往集中式日誌系統，附上追蹤 ID。

## 5. 測試計畫 (Testing Plan)
- **單元測試**：  
  - 表單驗證 (必填、長度、密碼遮蔽切換)。  
  - 深色模式切換狀態。  
  - 2FA UI 流程。  
- **整合測試**：  
  - 登入成功流程 (含 2FA)。  
  - 帳號/密碼錯誤 → 次數累計 → 6 次鎖定。  
  - 自動登出 → 1 分鐘提醒 → 強制登出。  
  - 稽核日誌記錄驗證。  
- **安全測試**：  
  - 密碼暴力攻擊模擬。  
  - Token/Session 管理 (重放、失效)。  
  - 前端敏感資料檢查 (DevTools)。  
- **驗收標準**：所有測試案例須通過，關鍵流程需提供錄影或截圖佐證。

## 6. 資源與角色 (Resources & Roles)
| 角色 | 負責範疇 |
| --- | --- |
| 前端工程師 | Login UI、表單驗證、深色模式、API 串接 |
| 後端工程師 | IdP 整合、登入 API、錯誤計數、2FA、稽核 |
| UI/UX 設計師 | Wireframe、視覺資產、Logo 位置與尺寸 |
| 測試工程師 | 測試計畫撰寫、執行、測試報告 |
| 系統管理員 | IdP 設定、2FA 通道 (SMS/Email) 配置 |

## 7. 風險與緩解 (Risks & Mitigations)
| 風險 | 影響 | 緩解措施 |
| --- | --- | --- |
| IdP/2FA API 尚未就緒 | 登入流程延宕 | 早期介面定義、使用模擬 API，事前確認通道供應商 SLA |
| SMS/Email 配送延遲 | 使用者體驗下降 | 預設雙通道、提供重新寄送與倒數提示 |
| 錯誤次數計數差異 | 鎖定邏輯失效 | 將計數集中於後端，並撰寫整合測試驗證 |
| 深色模式與品牌不一致 | UI 體驗不佳 | UI/UX 先行審查、提供設計規範與色票 |
| 稽核資料漏記 | 合規違反 | 測試案例覆蓋稽核、與操作紀錄模組同步檢查 |

## 8. 成功指標 (Success Metrics)
- 登入頁面 Lighthouse 可用性評分 ≥ 90。  
- 登入成功率 ≥ 99%（排除錯誤憑證）。  
- 2FA 驗證碼成功送達率 ≥ 98%。  
- 稽核日誌覆蓋率 100%。  
- 使用者回饋：登入流程滿意度 ≥ 4/5。

## 9. 憲章遵循檢查 (Constitution Check)
- **P1**：流程與 UI 保持簡潔，避免不必要步驟。  
- **P2**：採 OIDC/OAuth2、RBAC、2FA、稽核、HTTPS，符合安全設計。  
- **P3**：SPEC 中所有故事具可測試條件， PLAN 列出對應測試。  
- **P4**：里程碑拆分可逐步交付 (UI → 串接 → 測試)。  
- **P5**：所有文案與文件使用正體中文，保留語系切換機制。  
- **P6/P7**：訂定測試計畫並要求程式碼審查。  
- **P8**：遵循設計系統、Explicit Save 原則 (登入不涉及儲存但保留流程提示)。  
- **P9**：設定登入與 2FA 的效能門檻。  
- **P10–P13**：遵循 DDD 集中架構、IdP 統一、資料治理、可觀測性要求。  
- **H1–H3**：本計畫版本 1.0；後續變更以 Pull Request 修訂。

