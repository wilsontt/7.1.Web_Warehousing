# 規格文件 (SPEC): 文件倉儲管理系統（全域）
**版本**: 1.0  
**狀態**: [草稿]  
**負責人**: [IT 工程師 (您)]  
**依據設計規範**: `standards/2.文件倉儲管理系統 Warehouse Management System 設計規範v2.0.md`  
**依據憲章**: v2.1.0

## 1. 系統概述 (Overview)
本規格文件定義「文件倉儲管理系統」Web 版的核心行為與 UI/UX 要求。系統需提供穩定、安全且一致的使用體驗，支援桌面與平板操作，以八大作業主選單為導向進行模組化開發，並遵循專案憲章的不可協商原則。

## 2. 功能與使用者故事 (Features & User Stories)

### 2.1 全域 UI 框架
**使用者故事**  
- **身為** 任一系統角色使用者  
- **我想要** 在一致的頁面框架內操作各模組  
- **以便** 快速理解導覽與功能佈局

**驗收條件** – [憲章 P3, P8]  
- [ ] 介面採 A/B 區框架：A 區頂部導覽列固定於頁面頂端 (position: sticky)；B 區為主要內容。  
- [ ] A 區左側顯示品牌 Logo + 系統名稱，中間為主選單（直向展開），右側提供語系選擇及使用者下拉選單（顯示帳號、IP、登入時間、密碼變更、登出）。  
- [ ] B 區內部頁面採 Master-Detail 佈局：B1 左側列表 (預設寬 25%，min 18%，max 30%，可拖曳調整)，B2 右側詳細區。  
- [ ] 所有資料列表需符合：隔行變色、選取高亮、內容不自動折行 (whitespace-nowrap)、必要時顯示水平捲軸 (overflow-x-auto)。  
- [ ] B2-1 工具列統一包含：新增、修改、查詢(搜尋/篩選)、列印、確認、取消、停用/封存。按鈕需依資料狀態動態啟用/禁用。  
- [ ] 系統需支援淺色/深色模式，提供手動切換與依 OS 偏好自動切換，轉換需有流暢動畫。  
- [ ] 所有頁面需支援桌面與平板（含漢堡選單）之響應式佈局。

### 2.2 共用元件與資料表格行為
**使用者故事**  
- **身為** 系統管理員或一般使用者  
- **我想要** 在各頁面使用一致的資料表與元件行為  
- **以便** 快速熟悉操作並減少錯誤

**驗收條件** – [憲章 P3, P8]  
- [ ] DataTable 預設每頁 20 筆，可切換 5/10/20/50/100 筆，採 Tailwind UI 樣式。  
- [ ] 麵包屑 (Breadcrumbs) 採 Tailwind UI 元件，顯示完整導覽路徑（例：基本作業＞客戶資料維護＞客戶基本資料維護）。  
- [ ] 狀態列分左右兩邊顯示新增/修改人員與時間（格式：`新增人員：[姓名] YYYY/MM/DD HH:MM:SS`）。  
- [ ] Toolbar 按鈕行為標準化：  
  - 查詢 → 切換搜尋/篩選面板。  
  - 新增 → 清空表單進入新增模式。  
  - 修改 → 切換為編輯模式。  
  - 停用 → 對資料進行非刪除的停用標記。  
  - 刪除 → 只允許未被引用資料。  
  - 複製 → 以當前資料為模板建立新表單。  
- [ ] DataTable 容器需加入 `overflow-auto`，表頭需 sticky，搜尋框統一寬度 `w-40 (160px)`，表格行高標頭 `h-10 px-3`、內容 `py-2 px-3`，所有單元格顯示完整邊框。  
- [ ] 所有輸入欄位必須設定 `maxLength`，並提供即時驗證訊息。

### 2.3 登入與身分驗證
**使用者故事**  
- **身為** 系統使用者  
- **我想要** 透過安全的登入與驗證流程  
- **以便** 保護帳號並使用系統

**驗收條件** – [憲章 P2, P3, P8]  
- [ ] 登入頁提供帳號與密碼欄位，密碼預設遮蔽並具顯示/隱藏功能。  
- [ ] 登入錯誤時統一顯示：「您輸入的帳號或密碼不正確，請重新輸入。」並累計錯誤次數。  
- [ ] 同一帳號連續錯誤 6 次即鎖定並顯示：「您已連續輸入錯誤達 6 次，帳號已被鎖定。請與管理人員聯繫。」  
- [ ] 系統須提供 2FA 選項（簡訊或 Email）及 30 分鐘無操作自動登出，登出前 1 分鐘彈窗提醒。  
- [ ] 所有登入、登出、鎖定、2FA 操作需寫入稽核日誌（操作者、時間、IP、動作）。

### 2.4 Dashboard
**使用者故事**  
- **身為** 管理者或使用者  
- **我想要** 登入後看到即時的作業與庫存資訊  
- **以便** 快速掌握狀態並決策

**驗收條件** – [憲章 P3, P9]  
- [ ] 首頁上半部顯示：今日任務總覽、倉庫即時庫存概況、最新通知。  
- [ ] 下半部根據使用者角色顯示：所屬倉庫資訊（管理者可看全部）、各倉庫箱子容量/使用量/借出量、今日工作狀態、車輛派送即時狀況。  
- [ ] 顯示統計：逾時未銷毀數量 Top 10、存倉數量 (箱/件) Top 10、指定條件（客戶/部門/組別/成本中心 + 日期範圍 + 工作項目/原因）之長條圖趨勢。  
- [ ] 所有圖表需在 2 秒內載入完畢（正常負載）。

### 2.5 主選單與模組導覽
**使用者故事**  
- **身為** 任一角色使用者  
- **我想要** 透過主選單瀏覽所有功能模組  
- **以便** 快速定位所需作業

**驗收條件** – [憲章 P3, P8, P10]  
- [ ] 主選單包含八大作業，並根據登入者角色權限僅顯示可使用選項：  
  1. 基本作業 (Basic Operations)  
  2. 例行作業 (Routine Operations)  
  3. 庫存作業 (Inventory Operations)  
  4. 客戶作業 (Customer Operations)  
  5. 移儲作業 (Relocation Operations)  
  6. 稽核作業 (Audit Operations)  
  7. 倉儲管理作業 (Warehouse Administrative Operations)
  8. 系統管理作業 (System Administration Operations)  
- [ ] 各主選單需列出子功能與對應頁面，並與 B1/B2 佈局對應。  
- [ ] 所有有界上下文 (Bounded Context) 需依此主選單拆分模組，模組內文件、Plan、Task 必須追溯至此規格。

### 2.6 左側邊欄標準化計畫
**使用者故事**  
- **身為** 專案設計與開發人員  
- **我想要** 一致的左側邊欄佈局與元件  
- **以便** 加速開發並維持體驗

**驗收條件** – [憲章 P3, P8]  
- [ ] 第一階段：建立 `DESIGN_GUIDELINES.md`，記錄左側邊欄標準；所有左右分割頁面統一使用 `ResizableLayout`，廢棄 `MainLayout` 的 `leftPanel` 用法。  
- [ ] 第二階段：優化 `ResizableLayout`（預設 22%，min 18%，max 35%，註解標準配置），並優化 DataTable (固定表頭、統一搜尋框、減小行高、完整邊框)。建立 `DataTableConfig` 常數檔案統一顏色、間距、字體。  
- [ ] 第三階段：將現有頁面（從客戶資料維護開始）改用新佈局與設定。  
- [ ] 第四階段：建立標準模板與組件使用指南，提供程式碼範例與最佳實踐。

## 3. 非功能性需求 (Non-Functional Requirements)
- **效能** [憲章 P9]  
  - 所有主要 API 回應時間 ≤ 2 秒（正常負載），Dashboard 圖表 ≤ 2 秒。  
  - 左側列表篩選與資料切換需在 500ms 內完成。  
- **安全** [憲章 P2]  
  - 採用 OIDC/OAuth2 身分驗證、集中式 RBAC、所有 CUD 操作產生符合 ISO 27001 的稽核日誌。  
  - 敏感資料傳輸與儲存需加密，Session 閒置 30 分鐘自動失效。  
- **語言** [憲章 P5]  
  - 所有文案、錯誤訊息、文件採正體中文，保留多語系擴充。  
- **可用性**  
  - 支援鍵盤操作與無障礙標準（ARIA 標籤、Focus 狀態）。  
  - 深色模式與淺色模式皆須維持對比度與品牌一致性。  
- **可觀測性** [憲章 P13]  
  - 結構化日誌集中收集；提供健康檢查端點與關鍵指標 (登入成功率、API 延遲)。  
  - 分佈式追蹤追蹤跨模組 API 呼叫。

## 4. 模組依賴與資料規範 (Dependencies & Data Standards)
- 所有模組需依據八大主選單定義有界上下文，跨模組溝通採事件/訊息佇列（非同步）[憲章 P10].  
- 資料實體須明確定義擁有者模組，禁止跨模組直接存取他模組資料庫；Schema 變更透過遷移工具管理 [憲章 P12].  
- 前端狀態管理建議使用 Redux/Pinia 等統一方案；所有 API 需維護 OpenAPI (Swagger) 文件。  
- 登入頁與 Dashboard 須引用 `CROWN-Logo.png`，保留品牌一致性。

## 5. 測試與驗收 (Testing & Acceptance)
- 每個模組的 `PLAN` 文件需列出對應測試案例，並包含「憲章遵循檢查」章節 [憲章 H3]。  
- 登入、Dashboard、主選單、 DataTable 等共用元件需在單元/整合/端對端測試中覆蓋。  
- 針對安全需求進行滲透測試（登入暴力破解、防重放、XSS/CSRF）。  
- 驗收條件：所有測試案例通過、符合效能與安全指標、無重大 UX 問題。

### 2025/11/16 更新補充：主題與表格規範
- 全域主題切換需同步影響：A 區導覽列、主選單面板、內容區、所有表格、對話框、分頁列。
- 表格列 Hover/Selected 效果需明顯，並於深/淺色下各自對應色階。
- 分頁資訊顯示支援 `full | compact | auto` 三種模式；首頁列表建議使用 `auto` 以避免窄寬折行。 

## 6. 憲章遵循檢查 (Constitution Check)
- **P1**：規格強調簡潔一致的 UI 與模組化架構。  
- **P2**：登入、RBAC、稽核、加密、2FA、自動登出等安全措施已納入。  
- **P3**：所有功能提供可測試的驗收條件；規範測試與驗收流程。  
- **P4**：八大作業可分批交付；左側標準化計畫具階段性。  
- **P5**：明確要求所有文案使用正體中文。  
- **P7**：規範測試類型與驗收標準。  
- **P8**：統一 UI/UX 元件與 Explicit Save 原則。  
- **P9**：定義主要效能門檻。  
- **P10–P13**：遵循 DDD、模組化單體、資料治理與可觀測性要求。  
- **H1–H3**：本文件為 v1.0 草稿；後續變更需透過 Pull Request 修改版本號。

